# 子供向けパーソナライズAIエージェント 基本設計書

## 1. システム概要

本システムはiOSデバイス上で動作する子供向けパーソナライズAIエージェントです。ユーザー（子供）個人に合わせた対話体験を提供し、音声認識・音声合成、会話履歴管理、保護者による安全設定などを実現します。LLM（大規模言語モデル）との接続は抽象化されており、バックエンドAIは柔軟に差し替え可能です。

---

## 2. 主な機能要件

### 2.1 ユーザー管理
- 保護者による初期設定（子供の名前、生年月日、学年、趣味、得意・苦手科目など）
- 複数ユーザー（兄弟姉妹）対応
- ユーザーごとの会話履歴・設定情報保持

### 2.2 音声対話インターフェース
- iOS標準API（Apple Speech Framework）による音声認識
- AVSpeechSynthesizerによる音声合成
- 子供向けのトーン・声質選択

### 2.3 会話履歴・文脈管理
- 一定容量までの会話履歴保持（重要度・新旧による優先順位管理、期間経過で自動削除）
- ユーザー属性・会話履歴をエージェント応答に反映
- 外部ストレージ（Firebase FirestoreまたはSQLite）に会話データ保存

### 2.4 フィルタリング・安全管理
- 18禁・不適切な質問のフィルタリング（AI応答前にチェック、「その質問には答えられません」と返答）
- 保護者による利用時間帯設定・制限
- 不適切コンテンツフィルタのON/OFF切り替え

### 2.5 マルチモーダル拡張（将来対応）
- カメラ入力による画像認識（宿題撮影→正誤判定・解説）
- 図・表・動画等の視覚情報による学習支援

### 2.6 エージェント起動・ユーザー判定
- 子供の声を認識してユーザー判定
- エージェント自身の名前呼びかけによる起動

---

## 3. システム構成

### 3.1 フロントエンド（iOSアプリ）
- SwiftUIによるUI実装
- Apple Speech Frameworkによる音声認識
- AVSpeechSynthesizerによる音声合成
- 保護者向け初期設定画面・設定管理画面

### 3.2 バックエンド
- LLM APIラッパー層（OpenAI, Gemini, Claude等に差し替え可能な抽象クラス/プロトコルを設計）
- ユーザー属性・会話履歴管理（Firebase FirestoreまたはSQLite）
- フィルタリング・親権者コントロールロジック

### 3.3 データ管理
- ユーザー属性情報：ユーザーID、名前、性別、生年月日、学年、趣味、得意科目、苦手科目など
- 会話履歴：日付・時刻・発話内容・重要度・削除予定日等
- 保護者設定：不適切コンテンツフィルタ、利用可能時間帯、PINコード等

---

## 4. 外部インターフェース

### 4.1 LLM APIインターフェース
- 各種LLMサービス（OpenAI, Gemini, Claude等）のAPIエンドポイント
- プロンプト生成時にはユーザー属性・会話履歴を付与
- 応答取得後、フィルタリング処理を介して出力

### 4.2 ストレージインターフェース
- Firebase Firestore（クラウド保存の場合）またはSQLite（ローカル保存の場合）の読み書き
- データアクセス用の抽象レイヤーを設計し、将来的な拡張に対応

---

## 5. セキュリティ・プライバシー設計

- ユーザーデータは暗号化保存
- 保護者認証（Apple Sign InまたはPINコード）必須
- 会話履歴や個人情報へのアクセス権限を厳格に管理

---

## 6. 今後の拡張性・課題

- 子供の音声識別向上のためのAIモデル再学習・精度向上
- 会話履歴の容量管理・削除ルールの最適化
- 保護者向けのモニタリング・操作履歴管理機能
- マルチモーダル学習支援（画像・動画・表など）の段階的導入

---

## 7. 画面設計概要（保護者用初期設定）

1. お子さまの情報入力画面（名前、生年月日、性別、学年）
2. 興味・学習傾向入力画面（好きなこと、得意/苦手科目等）
3. 安全設定画面（不適切コンテンツフィルタ、利用可能時間帯指定、PIN等）

---

## 8. 技術スタックまとめ

| 区分 | 技術 |
|------|------|
| フロントエンド | SwiftUI (iOS) |
| 音声認識 | Apple Speech Framework |
| 音声合成 | AVSpeechSynthesizer |
| LLM API | OpenAI / Gemini / Claude（ラッパー層設計）|
| データ管理 | Firebase Firestore / SQLite |
| 認証 | Apple Sign In / PINコード |

---

## 9. シーケンス例（音声対話の流れ）

1. ユーザー（子供）がエージェント名を呼びかけて起動
2. 音声認識で入力を取得
3. 会話履歴・ユーザー属性情報をもとにプロンプト生成
4. LLM APIに問い合わせ
5. 応答文のフィルタリング・安全性チェック
6. 音声合成（子供向けトーンで出力）
7. 会話履歴を保存

---

## 10. その他

- 各種APIやデータ構造は抽象インターフェース化し、将来的な技術変更や機能追加に柔軟に対応
- 日本語対応を前提とする
